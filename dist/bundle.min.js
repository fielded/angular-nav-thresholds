!function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}e="default"in e?e.default:e;var a="YYYY-MM-DD",n={versionDateFormat:a},r=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=function(e,t){for(var a=0;a<e.length;a++)if(t(e[a]))return e[a]},i=function(e,t){var a=moment().isoWeekYear(e.year).isoWeek(e.week).isoWeekday(1).startOf("day"),r=moment(t.date,n.versionDateFormat).startOf("isoWeek").startOf("day");return a.isSameOrAfter(r)},l=function(e,t){return t._id===e},s=function(e,t){var a=e.slice(0).reverse(),n=o(a,i.bind(null,t));return n?n:e[0]},u=function(e,t){var a=function(){},n=function(){t.allocations&&t.allocations.length||a();var n=s(t.allocations,e.date);return n&&n.weeklyLevels},r=function(){t.plans&&t.plans.length||a();var n=s(t.plans,e.date);return n&&n.weeksOfStock},o=function(){var n=void 0;if(t.targetPopulations){t.targetPopulations.length||a();var r=s(t.targetPopulations,e.date);n=r&&r.monthlyTargetPopulations}else t.targetPopulation&&t.targetPopulation.length||a(),n=t.targetPopulation;return n};return{weeksOfStock:r(),weeklyLevels:n(),targetPopulations:o()}},c=function(){function e(a,n,r,o){t(this,e),this.$q=a,this.smartId=n,this.lgasService=r,this.statesService=o}return r(e,[{key:"calculateThresholds",value:function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(t&&t.date&&e&&e.level&&a&&a.length){var r=u(t,e),i=r.weeklyLevels,s=r.weeksOfStock,c=r.targetPopulations;if(i&&s)return Object.keys(i).reduce(function(t,r){return t[r]=Object.keys(s).reduce(function(t,u){var c=i[r]*s[u],f=o(a,l.bind(null,r)),v=20;f&&f.presentation&&(v=parseInt(f.presentation,10));var d=Math.ceil(c/v)*v;return t[u]=d,"zone"===e.level&&n[r]&&(t[u]+=n[r]),t},{}),c&&(t[r].targetPopulation=c[r]),t},{})}}},{key:"getThresholdsFor",value:function(e,t){var a=this,n="zone:?state:?lga",r={},i={};r=e.reduce(function(e,t){var r=t.location;if(!r)return e;var o=a.smartId.idify(r,n);return e[o]={date:t.date},r.lga?(i.lga||(i.lga=a.lgasService.list()),e[o].type="lga"):r.state&&(i.state||(i.state=a.statesService.list()),e[o].type="state"),e},{});var s=function(e){return Object.keys(r).forEach(function(n){var i=r[n],s=o(e[i.type],l.bind(null,n));i.thresholds=a.calculateThresholds(s,i,t),delete i.type}),r};return this.$q.all(i).then(s)}}]),e}();c.$inject=["$q","smartId","lgasService","statesService"],e.module("angularNavThresholds",["angularNavData","ngSmartId"]).service("thresholdsService",c)}(angular);