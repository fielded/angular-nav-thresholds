!function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}e="default"in e?e.default:e;var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),r=function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return e[n]},a=function(e,t){return t.version===e},o=function(e,t){return t._id===e},l={weeksOfStock:{min:0,reOrder:3,max:6}},i=function(e,t,n){return"last"===n.version?n.version:e[t]&&e[t].version?e[t].version:1},s=function(e,t,n){return"last"===n?t[t.length-1]:r(t,a.bind(null,n))},u=function(e,t,n){var r=function(){},a=function(){t.allocations&&t.allocations.length||r();var a=i(e,"allocations",n);"undefined"==typeof a&&r();var o=s(t,t.allocations,a);return o&&o.weeklyLevels},o=function(){"zone"===t.level||t.plans&&t.plans.length||r();var a=i(e,"plans",n);"undefined"==typeof a&&r();var o=l;return"zone"!==t.level&&(o=s(t,t.plans,a)),o&&o.weeksOfStock},u=function(){var a=void 0;if(t.targetPopulations){t.targetPopulations.length||r();var o=i(e,"targetPopulations",n);"undefined"==typeof o&&r();var l=s(t,t.targetPopulations,o);a=l&&l.monthlyTargetPopulations}else t.targetPopulation&&t.targetPopulation.length||r(),a=t.targetPopulation;return a};return{weeksOfStock:o(),weeklyLevels:a(),targetPopulations:u()}},c=function(){function e(n,r,a,o){t(this,e),this.$q=n,this.smartId=r,this.lgasService=a,this.statesService=o}return n(e,[{key:"calculateThresholds",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(t&&(e||!e.level)&&n&&n.length){var i=u(t,e,l),s=i.weeklyLevels,c=i.weeksOfStock,v=i.targetPopulations;if(s&&c&&v)return Object.keys(s).reduce(function(t,l){return t[l]=Object.keys(c).reduce(function(t,i){var u=s[l]*c[i],v=r(n,o.bind(null,l)),f=20;v&&v.presentation&&(f=parseInt(v.presentation,10));var g=Math.ceil(u/f)*f;return t[i]=g,"zone"===e.level&&a[l]&&(t[i]+=a[l]),t},{}),t[l].targetPopulation=v[l],t},{})}}},{key:"getThresholdsFor",value:function(e,t){var n=this,a="zone:?state:?lga",l={},i={};l=e.reduce(function(e,t){var r=t.location;if(!r)return e;var o=n.smartId.idify(r,a),l=t.allocations||{version:1},s=t.plans||{version:1},u=t.targetPopulations||{version:1};return e[o]=angular.merge({},{allocations:l,plans:s,targetPopulations:u}),r.lga?(i.lga||(i.lga=n.lgasService.list()),e[o].type="lga"):r.state&&(i.state||(i.state=n.statesService.list()),e[o].type="state"),e},{});var s=function(e){return Object.keys(l).forEach(function(a){var i=l[a],s=r(e[i.type],o.bind(null,a));i.thresholds=n.calculateThresholds(s,i,t),delete i.type}),l};return this.$q.all(i).then(s)}}]),e}();c.$inject=["$q","smartId","lgasService","statesService"],e.module("angularNavThresholds",["angularNavData","ngSmartId"]).service("thresholdsService",c)}(angular);